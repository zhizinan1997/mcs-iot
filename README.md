# MCS-IoT å·¥ä¸šçº§æ°”ä½“ç›‘æµ‹ç‰©è”ç½‘å¹³å°

ä¸“ä¸ºå·¥ä¸šæ°”ä½“ç›‘æµ‹åœºæ™¯è®¾è®¡çš„ç‰©è”ç½‘äº‘å¹³å°ï¼Œæ”¯æŒå®æ—¶æ•°æ®é‡‡é›†ã€å¯è§†åŒ–å¤§å±ã€æ™ºèƒ½æŠ¥è­¦ã€è®¾å¤‡ç®¡ç†å’Œ AI åˆ†æã€‚

---

## ğŸš€ ä¸€é”®éƒ¨ç½²

æ”¯æŒ Ubuntu 20.04+ã€CentOS 7+ã€OpenCloudOSã€Debian 10+

```bash
# ä¸€é”®éƒ¨ç½²ï¼ˆè‡ªåŠ¨æ‹‰å–æœ€æ–°è„šæœ¬ï¼‰
bash <(curl -sSL https://raw.githubusercontent.com/zhizinan1997/mcs-iot/main/scripts/deploy.sh)
```

**é¦–æ¬¡å®‰è£…è‡ªåŠ¨å®Œæˆï¼š**

- âœ… ç¯å¢ƒæ£€æµ‹ä¸ä¾èµ–å®‰è£… (Docker)
- âœ… åŸŸåé…ç½®ä¸ API å¯†é’¥é…ç½®
- âœ… æ‹‰å–é¢„æ„å»º Docker é•œåƒ (æ— éœ€æœ¬åœ°æ„å»º)
- âœ… æ•°æ®åº“åˆå§‹åŒ–
- âœ… å¯é€‰å¯¼å…¥æ¼”ç¤ºæ•°æ®

**å·²æœ‰å®‰è£…æ—¶è‡ªåŠ¨æ£€æµ‹ï¼Œæ”¯æŒï¼š**

- ğŸ”„ æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ (ä¿ç•™æ•°æ®)
- ğŸ’¾ è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
- ğŸ“¦ æ‹‰å–æœ€æ–°é•œåƒå¹¶é‡å¯

> âš ï¸ **æ³¨æ„**: SSL è¯ä¹¦éœ€è¦åœ¨å®å¡”é¢æ¿ä¸­æ‰‹åŠ¨ç”³è¯·å’Œé…ç½®

---

## ğŸ†• æœ€æ–°åŠŸèƒ½

- **æˆæƒç®¡ç†ç³»ç»Ÿ** - åŸºäº Cloudflare Worker çš„è®¾å¤‡æˆæƒéªŒè¯
- **AI æ™ºèƒ½åˆ†æ** - å®šæ—¶ç”Ÿæˆå¹³å°è¿è¡ŒçŠ¶å†µæ™ºèƒ½æ€»ç»“
- **é¢„æ„å»ºé•œåƒ** - æ‰˜ç®¡äº ghcr.ioï¼Œæ— éœ€æœ¬åœ°æ„å»º
- **ä¸€é”®å‡çº§** - è‡ªåŠ¨æ£€æµ‹ç°æœ‰éƒ¨ç½²ï¼Œæ”¯æŒæ— ç¼å‡çº§

---

## âš ï¸ éƒ¨ç½²å‰å‡†å¤‡

### 1. å‡†å¤‡åŸŸå

| åŸŸå      | ç”¨é€”       | ç¤ºä¾‹                 |
| --------- | ---------- | -------------------- |
| ä¸»åŸŸå    | ç®¡ç†åå°   | `iot.example.com`    |
| API åŸŸå  | æ¥å£æœåŠ¡   | `api.example.com`    |
| MQTT åŸŸå | è®¾å¤‡è¿æ¥   | `mqtt.example.com`   |
| å¤§å±åŸŸå  | å¯è§†åŒ–å±•ç¤º | `screen.example.com` |

### 2. å¼€æ”¾ç«¯å£

| ç«¯å£ | ç”¨é€”        |
| ---- | ----------- |
| 80   | HTTP        |
| 443  | HTTPS       |
| 8883 | MQTT TLS    |
| 1883 | MQTT (å¯é€‰) |

---

## ğŸ”§ éƒ¨ç½²åé…ç½®

### å®å¡”é¢æ¿é…ç½®

1. **åˆ›å»ºç½‘ç«™å¹¶ç”³è¯· SSL è¯ä¹¦** - ä½¿ç”¨ Let's Encrypt
2. **é…ç½®åå‘ä»£ç†**ï¼š
   - ä¸»ç«™: `127.0.0.1:3000`
   - API: `127.0.0.1:8000`
3. **MQTT TLS è¯ä¹¦** - å¤åˆ¶åˆ° `/opt/mcs-iot/nginx/ssl/`

### æˆæƒæœåŠ¡å™¨é…ç½® (å¯é€‰)

é¡¹ç›®åŒ…å« Cloudflare Worker æˆæƒæœåŠ¡ï¼Œéœ€è¦å•ç‹¬éƒ¨ç½²ï¼š

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. åˆ›å»º Workerï¼Œç²˜è´´ `cfworker/license-server.js` ä»£ç 
3. ç»‘å®š KV å‘½åç©ºé—´ `LICENSES`
4. è®¾ç½®ç¯å¢ƒå˜é‡ `ADMIN_TOKEN`

---

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

```bash
# æœåŠ¡ç®¡ç†
mcs-iot start      # å¯åŠ¨æœåŠ¡
mcs-iot stop       # åœæ­¢æœåŠ¡
mcs-iot restart    # é‡å¯æœåŠ¡
mcs-iot status     # æŸ¥çœ‹çŠ¶æ€
mcs-iot logs       # æŸ¥çœ‹æ—¥å¿—

# æ¨¡æ‹Ÿå™¨ (æ°¸ä¹…è¿è¡Œï¼Œ10ç§’/æ¡æ•°æ®)
mcs-simulator-start    # å¯åŠ¨ 24 ä¸ªæ¨¡æ‹Ÿä¼ æ„Ÿå™¨
mcs-simulator-stop     # åœæ­¢æ¨¡æ‹Ÿå™¨
```

---

## ğŸ”„ å‡çº§æ–¹æ³•

```bash
cd /opt/mcs-iot
bash scripts/deploy.sh
# é€‰æ‹© 1 - æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
```

å‡çº§è¿‡ç¨‹ä¼šè‡ªåŠ¨ï¼šå¤‡ä»½æ•°æ®åº“ â†’ æ‹‰å–ä»£ç  â†’ æ›´æ–°é•œåƒ â†’ é‡å¯æœåŠ¡

---

## ğŸ“¡ è®¾å¤‡æ¥å…¥

### MQTT å‚æ•°

| å‚æ•°   | å€¼                    |
| ------ | --------------------- |
| Broker | `mqtt.yourdomain.com` |
| ç«¯å£   | 8883 (TLS)            |
| ç”¨æˆ·å | ç®¡ç†åå°é…ç½®          |

### ä¸Šè¡Œæ•°æ® (Topic: `mcs/{è®¾å¤‡SN}/up`)

```json
{
  "ts": 1702723200,
  "seq": 123,
  "v_raw": 2045.5,
  "temp": 25.3,
  "humi": 45.2,
  "bat": 85,
  "rssi": -72,
  "net": "4G",
  "err": 0
}
```

---

## ğŸ³ Docker é•œåƒ

é¢„æ„å»ºé•œåƒæ‰˜ç®¡äº GitHub Container Registryï¼š

```
ghcr.io/zhizinan1997/mcs-iot-backend:latest
ghcr.io/zhizinan1997/mcs-iot-worker:latest
ghcr.io/zhizinan1997/mcs-iot-frontend:latest
```

æ‰‹åŠ¨éƒ¨ç½²ï¼š

```bash
docker compose -f docker-compose.ghcr.yml pull
docker compose -f docker-compose.ghcr.yml up -d
```

---

## â— å¸¸è§é—®é¢˜

### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
mcs-iot status
mcs-iot logs
```

### MQTT è¿æ¥å¤±è´¥

- æ£€æŸ¥ SSL è¯ä¹¦æ˜¯å¦åœ¨ `/opt/mcs-iot/nginx/ssl/`
- ç¡®ä¿æ–‡ä»¶åä¸º `server.crt` å’Œ `server.key`
- é‡å¯ï¼š`mcs-iot restart`

### å‡çº§åæœåŠ¡å¼‚å¸¸

```bash
# æ¢å¤æ•°æ®åº“å¤‡ä»½
cat backup_YYYYMMDD_HHMMSS.sql | docker exec -i mcs_db psql -U postgres mcs_iot
```

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

**å¼€å‘è€…**: Ryan Zhi | **é‚®ç®±**: <zinanzhi@gmail.com>
