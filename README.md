# MCS-IoT å·¥ä¸šçº§æ°”ä½“ç›‘æµ‹ç‰©è”ç½‘å¹³å°

ä¸“ä¸ºå·¥ä¸šæ°”ä½“ç›‘æµ‹åœºæ™¯è®¾è®¡çš„ç‰©è”ç½‘äº‘å¹³å°ï¼Œæ”¯æŒå®æ—¶æ•°æ®é‡‡é›†ã€å¯è§†åŒ–å¤§å±ã€æ™ºèƒ½æŠ¥è­¦å’Œè®¾å¤‡ç®¡ç†ã€‚

---

## ğŸš€ ä¸€é”®éƒ¨ç½²

æ”¯æŒ Ubuntu 20.04+ã€CentOS 7+ã€OpenCloudOSã€Debian 10+

```bash
curl -sSL https://raw.githubusercontent.com/zhizinan1997/mcs-iot/main/scripts/deploy.sh -o deploy.sh
chmod +x deploy.sh
sudo ./deploy.sh
```

**è„šæœ¬å°†è‡ªåŠ¨å®Œæˆï¼š**

- âœ… ç¯å¢ƒæ£€æµ‹ä¸ä¾èµ–å®‰è£… (Docker, Certbot)
- âœ… åŸŸåé…ç½®ä¸ SSL è¯ä¹¦ç”³è¯· (Let's Encrypt)
- âœ… æ•°æ®åº“å¯†ç ä¸ API å¯†é’¥é…ç½®
- âœ… Docker å®¹å™¨éƒ¨ç½²
- âœ… å¯é€‰å¯¼å…¥æ¼”ç¤ºæ•°æ®

---

## âš ï¸ éƒ¨ç½²å‰å‡†å¤‡

### 1. åœæ­¢å·²æœ‰æœåŠ¡

å¦‚æœæœåŠ¡å™¨å·²å®‰è£… Nginxã€Redisã€PostgreSQLï¼Œ**å¿…é¡»å…ˆåœæ­¢å®ƒä»¬**ï¼š

```bash
# åœæ­¢æœåŠ¡
systemctl stop nginx
systemctl stop redis
systemctl stop postgresql

# ç¦æ­¢å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰
systemctl disable nginx redis postgresql

# ç¡®è®¤ç«¯å£å·²é‡Šæ”¾
ss -tuln | grep -E ':(80|443|5432|6379)'
```

### 2. å‡†å¤‡åŸŸå

éƒ¨ç½²å‰è¯·å‡†å¤‡ 4 ä¸ªåŸŸåå¹¶è§£æåˆ°æœåŠ¡å™¨ IPï¼š

| åŸŸå      | ç”¨é€”       | ç¤ºä¾‹                 |
| --------- | ---------- | -------------------- |
| ä¸»åŸŸå    | ç®¡ç†åå°   | `iot.example.com`    |
| API åŸŸå  | æ¥å£æœåŠ¡   | `api.example.com`    |
| MQTT åŸŸå | è®¾å¤‡è¿æ¥   | `mqtt.example.com`   |
| å¤§å±åŸŸå  | å¯è§†åŒ–å±•ç¤º | `screen.example.com` |

### 3. å¼€æ”¾ç«¯å£

åœ¨äº‘æœåŠ¡å•†æ§åˆ¶å°ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘å®‰å…¨ç»„ï¼‰æ”¾è¡Œä»¥ä¸‹ç«¯å£ï¼š

| ç«¯å£ | ç”¨é€”                    |
| ---- | ----------------------- |
| 80   | HTTP (SSL è¯ä¹¦éªŒè¯éœ€è¦) |
| 443  | HTTPS                   |
| 8883 | MQTT TLS                |
| 1883 | MQTT (å¯é€‰)             |

---

## ğŸ› ï¸ éƒ¨ç½²åç®¡ç†

```bash
# æœåŠ¡ç®¡ç†
mcs-iot start      # å¯åŠ¨æœåŠ¡
mcs-iot stop       # åœæ­¢æœåŠ¡
mcs-iot restart    # é‡å¯æœåŠ¡
mcs-iot status     # æŸ¥çœ‹çŠ¶æ€
mcs-iot logs       # æŸ¥çœ‹æ—¥å¿—

# æ¨¡æ‹Ÿå™¨
mcs-simulator-start    # å¯åŠ¨ 24 ä¸ªæ¨¡æ‹Ÿä¼ æ„Ÿå™¨
mcs-simulator-stop     # åœæ­¢æ¨¡æ‹Ÿå™¨
```

---

## ğŸ“¡ è®¾å¤‡æ¥å…¥

### MQTT å‚æ•°

| å‚æ•°   | å€¼                    |
| ------ | --------------------- |
| Broker | `mqtt.yourdomain.com` |
| ç«¯å£   | 8883 (TLS)            |
| ç”¨æˆ·å | ç®¡ç†åå°é…ç½®          |

### ä¸Šè¡Œæ•°æ® (Topic: `mcs/{è®¾å¤‡SN}/up`)

```json
{
  "ts": 1702723200,
  "seq": 123,
  "v_raw": 2045.5,
  "temp": 25.3,
  "humi": 45.2,
  "bat": 85,
  "rssi": -72,
  "net": "4G",
  "err": 0
}
```

---

## â— å¸¸è§é—®é¢˜

### SSL è¯ä¹¦ç”³è¯·å¤±è´¥

- ç¡®ä¿ 80 ç«¯å£å¼€æ”¾ä¸”æœªè¢«å ç”¨
- ç¡®ä¿åŸŸåå·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IP
- Let's Encrypt æœ‰é¢‘ç‡é™åˆ¶ï¼Œå¤±è´¥åç­‰å¾… 1 å°æ—¶å†è¯•

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨è¿›ç¨‹
lsof -i :80 -i :443 -i :5432 -i :6379

# åœæ­¢å·²æœ‰æœåŠ¡
systemctl stop nginx redis postgresql
```

### è„šæœ¬æ„å¤–é€€å‡º

```bash
# æŸ¥çœ‹è„šæœ¬è¿è¡Œæ—¥å¿—
bash -x deploy.sh 2>&1 | tee deploy.log
```

---

## ğŸ“„ è®¸å¯è¯

MIT License
